<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Offres de stage</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Optional: Bootstrap Icons (Ø¨Ø§Ø´ Ù†Ø²ÙŠØ¯Ùˆ icons Ø²ÙˆÙŠÙ†Ø©) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <style>
    /* ===== Background Premium ===== */
    body{
      min-height: 100vh;
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(13,110,253,0.18), transparent 55%),
        radial-gradient(900px 500px at 85% 15%, rgba(111,66,193,0.16), transparent 60%),
        radial-gradient(900px 600px at 30% 90%, rgba(32,201,151,0.14), transparent 60%),
        linear-gradient(135deg, #f7f9fc, #e9f0fb);
      background-attachment: fixed;
      overflow-x: hidden;
    }

    /* subtle animated grain */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
      opacity: .20;
      pointer-events: none;
      mix-blend-mode: overlay;
      animation: grainMove 10s linear infinite;
    }
    @keyframes grainMove{
      0%{ transform: translate3d(0,0,0); }
      50%{ transform: translate3d(-2%, 1%, 0); }
      100%{ transform: translate3d(0,0,0); }
    }

    /* ===== Page Title Card ===== */
    .page-hero{
      border-radius: 22px;
      background: rgba(255,255,255,0.65);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.6);
      box-shadow: 0 14px 40px rgba(0,0,0,.08);
      padding: 26px 18px;
      position: relative;
      overflow: hidden;
    }
    .page-hero::after{
      content:"";
      position:absolute;
      inset:-60px -120px auto auto;
      width: 260px; height: 260px;
      background: radial-gradient(circle at 30% 30%, rgba(13,110,253,.22), transparent 60%);
      transform: rotate(10deg);
      filter: blur(0px);
    }

    /* ===== Cards (Premium) ===== */
    .card{
      border: none;
      border-radius: 18px;
      background: rgba(255,255,255,0.72);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.08);
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
      border: 1px solid rgba(255,255,255,0.65);
      overflow: hidden;
      position: relative;
      transform-style: preserve-3d;
      will-change: transform;
    }

    /* top glow line */
    .card::before{
      content:"";
      position:absolute;
      top:0; left:0; right:0;
      height: 3px;
      background: linear-gradient(90deg, rgba(13,110,253,.0), rgba(13,110,253,.55), rgba(111,66,193,.55), rgba(32,201,151,.55), rgba(13,110,253,.0));
      opacity: .9;
    }

    .card:hover{
      transform: translateY(-8px) scale(1.01);
      box-shadow: 0 18px 46px rgba(0,0,0,0.14);
    }

    /* ===== Sector badge ===== */
    .badge-sector{
      background: linear-gradient(90deg, #6c757d, #495057);
      border-radius: 999px;
      padding: .45rem .75rem;
      font-weight: 600;
      letter-spacing: .2px;
    }

    /* ===== Small chips style ===== */
    .chip{
      display:inline-flex;
      align-items:center;
      gap:.45rem;
      padding: .35rem .6rem;
      border-radius: 999px;
      background: rgba(13,110,253,0.10);
      border: 1px solid rgba(13,110,253,0.18);
      color: #0b4ec2;
      font-weight: 600;
      font-size: .82rem;
    }

    /* ===== Buttons ===== */
    .btn-primary{
      border: none;
      border-radius: 14px;
      padding: .72rem .9rem;
      font-weight: 700;
      background: linear-gradient(135deg, #0d6efd, #6f42c1);
      box-shadow: 0 10px 22px rgba(13,110,253,0.25);
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
    }
    .btn-primary:hover{
      transform: translateY(-2px);
      filter: brightness(1.05);
      box-shadow: 0 14px 32px rgba(13,110,253,0.32);
    }
    .btn-primary:active{
      transform: translateY(0px);
      box-shadow: 0 8px 18px rgba(13,110,253,0.22);
    }

    /* ===== Reveal-on-scroll animation ===== */
    .reveal{
      opacity: 0;
      transform: translateY(18px) scale(0.985);
      transition: opacity .7s ease, transform .7s cubic-bezier(.2,.65,.2,1);
    }
    .reveal.is-visible{
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    /* Stagger delay from inline style set by JS */
    .reveal.is-visible{
      transition-delay: var(--d, 0ms);
    }

    /* ===== Text tweaks ===== */
    .card-title{
      line-height: 1.25;
    }
    .muted-strong{
      color: rgba(0,0,0,0.60);
    }

    /* ===== Reduced motion (accessibility) ===== */
    @media (prefers-reduced-motion: reduce){
      .reveal, .card, body::before{
        animation: none !important;
        transition: none !important;
        transform: none !important;
      }
    }
  </style>
</head>

<body>

<div class="container py-5">

  <!-- Messages -->
  {% if messages %}
    <div class="mb-4">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Title -->
  <div class="text-center mb-5 page-hero reveal">
    <h1 class="fw-bold mb-2">ðŸŽ“ Offres de stage disponibles</h1>
    <p class="text-muted mb-0">Veuillez choisir lâ€™offre qui vous convient et y postuler directement.</p>
    <div class="mt-3 d-flex justify-content-center gap-2 flex-wrap">
      <span class="chip"><i class="bi bi-lightning-charge-fill"></i> Nouveau design</span>
      <span class="chip"><i class="bi bi-stars"></i> Animation scroll</span>
      <span class="chip"><i class="bi bi-shield-check"></i> Bootstrap + JS</span>
    </div>
  </div>

  {% if offres %}
    <div class="row g-4">
      {% for offre in offres %}
        <div class="col-md-6 col-lg-4 reveal">
          <div class="card h-100">
            <div class="card-body d-flex flex-column">

              <!-- Titre -->
              <h5 class="card-title fw-bold mb-2">
                <i class="bi bi-briefcase-fill me-1 text-primary"></i>
                {{ offre.titre }}
              </h5>

              <!-- Entreprise -->
              <p class="mb-1 muted-strong">
                <strong class="text-dark">Entreprise :</strong>
                {{ offre.entreprise.nom }}
              </p>

              {% if offre.entreprise.secteur %}
                <span class="badge badge-sector mb-2">
                  <i class="bi bi-building me-1"></i>{{ offre.entreprise.secteur }}
                </span>
              {% endif %}

              <!-- Description -->
              <p class="card-text mt-2 text-muted">
                {{ offre.description|truncatechars:130 }}
              </p>

              <!-- Dates -->
              <p class="small text-muted mb-2">
                <i class="bi bi-calendar-event me-1"></i>
                {{ offre.date_debut }} â†’ {{ offre.date_fin }}
              </p>

              <!-- Infos entreprise -->
              <div class="small text-muted mb-3">
                {% if offre.entreprise.email %}
                  <div class="mb-1"><i class="bi bi-envelope me-1"></i>{{ offre.entreprise.email }}</div>
                {% endif %}
                {% if offre.entreprise.telephone %}
                  <div class="mb-1"><i class="bi bi-telephone me-1"></i>{{ offre.entreprise.telephone }}</div>
                {% endif %}
                {% if offre.entreprise.site_web %}
                  <div>
                    <i class="bi bi-globe me-1"></i>
                    <a href="{{ offre.entreprise.site_web }}" target="_blank" class="link-primary link-underline-opacity-0 link-underline-opacity-75-hover">
                      Site web
                    </a>
                  </div>
                {% endif %}
              </div>

              <!-- Button -->
              <div class="mt-auto">
                <a class="btn btn-primary w-100"
                   href="{% url 'stages:postuler' offre.id %}">
                  ðŸš€ Postuler
                </a>
              </div>

            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info text-center reveal">
      Ù…Ø§ ÙƒØ§ÙŠÙ†Ø§Ø´ Ø¹Ø±ÙˆØ¶ Ø¯Ø§Ø¨Ø§.
    </div>
  {% endif %}

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Reveal on scroll + slight tilt hover -->
<script>
  // ===== 1) Reveal-on-scroll (IntersectionObserver) =====
  (function () {
    const els = document.querySelectorAll(".reveal");
    const obs = new IntersectionObserver((entries) => {
      entries.forEach((e) => {
        if (e.isIntersecting) {
          e.target.classList.add("is-visible");
          obs.unobserve(e.target);
        }
      });
    }, { threshold: 0.12, rootMargin: "0px 0px -6% 0px" });

    els.forEach((el, i) => {
      // stagger effect
      el.style.setProperty("--d", (i % 12) * 70 + "ms");
      obs.observe(el);
    });
  })();

  // ===== 2) Tiny 3D tilt on cards (desktop only) =====
  (function () {
    const cards = document.querySelectorAll(".card");
    const isTouch = matchMedia("(pointer: coarse)").matches;

    if (isTouch) return;

    cards.forEach((card) => {
      card.addEventListener("mousemove", (e) => {
        const r = card.getBoundingClientRect();
        const x = e.clientX - r.left;
        const y = e.clientY - r.top;
        const rx = ((y / r.height) - 0.5) * -6; // rotateX
        const ry = ((x / r.width) - 0.5) *  8;  // rotateY
        card.style.transform = `translateY(-8px) scale(1.01) rotateX(${rx}deg) rotateY(${ry}deg)`;
      });

      card.addEventListener("mouseleave", () => {
        card.style.transform = "";
      });
    });
  })();
</script>

</body>
</html>
